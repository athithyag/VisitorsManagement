



{% comment %} 
<form method="POST" id="qr-form">
    {% csrf_token %}
    
    <label for="verification_code">Enter Verification Code:</label>
    <input type="text" name="verification_code" id="verification_code" value="{{ verification_code }}" required>
    
    <!-- Display in_time and out_time -->
    <label for="in_time">In Time:</label>
    <input type="text" name="in_time" id="in_time" value="{{ in_time|date:'H:i' }}" readonly>
    
    <label for="out_time">Out Time:</label>
    <input type="text" name="out_time" id="out_time" value="{{ out_time|date:'H:i' }}" readonly>
    
    <button type="submit">Submit</button>
</form>

<script>
    document.getElementById('qr-form').onsubmit = function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch("", {
            method: "POST",
            body: formData,
        })
        .then(response => response.json())
        .then(data => alert(data.message));
    };
</script> {% endcomment %}

{% comment %} 
<form method="POST" id="qr-form">
    {% csrf_token %}
    
    <label for="verification_code">Enter Verification Code:</label>
    <input type="text" name="verification_code" id="verification_code" value="{{ verification_code }}" required>
    
    <!-- Display in_time if it's already set, else it will be updated by JS -->
    <label for="in_time">In Time:</label>
    <input type="text" name="in_time" id="in_time" value="{{ in_time|date:'H:i' }}" readonly>
    
    <!-- Let the visitor manually enter out_time -->
    <label for="out_time">Out Time:</label>
    <input type="time" name="out_time" id="out_time">
    
    <button type="submit">Submit</button>
</form> {% endcomment %}

<!-- Include Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h4 class="card-title text-center mb-4">Visitor Check-In/Check-Out</h4>
            <form method="POST" id="qr-form">
                {% csrf_token %}

                <!-- Verification Code Input -->
                <div class="mb-3">
                    <label for="verification_code" class="form-label">Enter Verification Code:</label>
                    <input 
                        type="text" 
                        class="form-control" 
                        name="verification_code" 
                        id="verification_code" 
                        value="{{ verification_code }}" 
                        placeholder="Enter your code" 
                        required>
                </div>

                <!-- In Time Display -->
                <div class="mb-3">
                    <label for="in_time" class="form-label">In Time:</label>
                    <input 
                        type="text" 
                        class="form-control" 
                        name="in_time" 
                        id="in_time" 
                        value="{{ in_time|date:'H:i' }}" 
                        readonly>
                </div>

                <!-- Out Time Input -->
                <div class="mb-3">
                    <label for="out_time" class="form-label">Out Time:</label>
                    <input 
                        type="time" 
                        class="form-control" 
                        name="out_time" 
                        id="out_time">
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary px-5">Submit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Optional Bootstrap JS for interactivity -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('qr-form').onsubmit = function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch("", {
            method: "POST",
            body: formData,
        })
        .then(response => response.json())
        .then(data => alert(data.message));
    };
</script>

<script>
    document.getElementById('qr-form').onsubmit = function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch("", {
            method: "POST",
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);

            if (data.status === 'success') {
                // Update the in_time field with the value returned by the backend
                document.getElementById('in_time').value = data.in_time;
            }
        });
    };
</script>
